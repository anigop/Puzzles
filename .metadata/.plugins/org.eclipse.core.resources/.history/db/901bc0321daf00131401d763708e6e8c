import java.math.BigInteger;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.PriorityQueue;



public class ComputeMaxCorrelation {

	public static final int TOP_N_RANKS = 3;
	private static ArrayList<OutputRecord> op;
	
	
	public static class Heapnode implements Comparable<Heapnode> {
		public String id;
		public int count;
		public int compareTo(Heapnode l){
			if(this.count < l.count){
				return 1;
			}
			return -1;
		}
	}
	
	
	public static  void start(String filename){
		GsonObject g = FileRead.readFromFile(filename);
		Graph graph = new Graph();
		op = new ArrayList<OutputRecord>();
		
		graph.buildGraph(g);
		if(g.getInput().size() > 0){
			
			for(Record r : g.getInput()){
				
				if(graph.getGraph().get(r.getId()) != null){
					HashSet<Node> firstDegree = new HashSet<Node>();
					HashSet<Node> secondDegreeConnections = new HashSet<Node>();
					
					for(Node n : graph.getGraph().get(r.getId()).getIngress()){
						firstDegree.add(n);
					}
					
					for(Node n : firstDegree){
						for(Node d : n.getIngress()){
							if(!firstDegree.contains(d) && (!d.getId().equals(r.getId()))){
								secondDegreeConnections.add(d);
							}
						}
					}
					compute(r.getId() , firstDegree, secondDegreeConnections);
				}
			}
		}
		
		for(OutputRecord o : op){
			System.out.println(o.getId()+"   "+o.getTop3());
		}
	}
	
	public static void compute(String id  , HashSet<Node> firstDegree , HashSet<Node> secondDegreeConnections){
		
		PriorityQueue<Heapnode> heap = new PriorityQueue<Heapnode>();
		for(Node n : secondDegreeConnections){
			int count = 0;
			for(Node out : n.getEgress()){
				count = firstDegree.contains(out) ? count+1: count;
			}
			
			if(count > 0){
				Heapnode h = new Heapnode();
				h.count = count;
				h.id = n.getId();
				
				heap.add(h);
			}
		}
		
		
		OutputRecord o = new OutputRecord();
		int count = 0;
		o.setId(id);
		while(!heap.isEmpty() && count < TOP_N_RANKS){
			Heapnode h = heap.remove();
			o.getTop3().add(new BigInteger(h.id));
			count++;
		}
		
		System.out.println(op.size());
		op.add(o);
		
	}
		
	
	
	
}
